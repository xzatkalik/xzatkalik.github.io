!function($){window.iinfo=window.iinfo||{},iinfo.promo=iinfo.promo||{},iinfo.promo.PromoItem=function(promoId,phase){this.promoId=promoId,this.phase=phase,this.displayed=!1},iinfo.promo.PromoItem.prototype.getDisplayed=function(){return this.displayed},iinfo.promo.PromoItem.prototype.setDisplayed=function(displayed){this.displayed=displayed},iinfo.promo.PromoItem.PHASE_PREFERRED="preferred",iinfo.promo.PromoItem.PHASE_NEW="new",iinfo.promo.PromoItem.PHASE_CTR="ctr",iinfo.promo.PromoItem.getPhaseByKey=function(key){switch(key){case iinfo.promo.PromoItem.PHASE_PREFERRED:return iinfo.promo.PromoItem.PHASE_PREFERRED;case iinfo.promo.PromoItem.PHASE_NEW:return iinfo.promo.PromoItem.PHASE_NEW;case iinfo.promo.PromoItem.PHASE_CTR:return iinfo.promo.PromoItem.PHASE_CTR}throw new Error("Invalid Promo Phase key: "+key)},iinfo.promo.PromoItem.prototype.getPhaseWeight=function(){switch(this.phase){case iinfo.promo.PromoItem.PHASE_PREFERRED:return 2;case iinfo.promo.PromoItem.PHASE_NEW:return 1;case iinfo.promo.PromoItem.PHASE_CTR:return 0}throw new Error("Invalid Promo Phase key: "+key)},iinfo.promo.PromoApiFooter=function(urlIncrementDisplay){this.urlIncrementDisplay=urlIncrementDisplay},iinfo.promo.PromoApiFooter.prototype.display=function(items){var that=this,itemsNotInProgress=items.filter(function(item){return!that.isDisplayInProgress(item)});if(0<itemsNotInProgress.length){this.setAllDisplayInProgress(itemsNotInProgress,!0);var xhr=new XMLHttpRequest;xhr.addEventListener("load",function(){200===this.status?itemsNotInProgress.forEach(function(item){item.setDisplayed(!0)}):console.error("Promo display error",this),that.setAllDisplayInProgress(itemsNotInProgress,!1)}),xhr.open("POST",this.urlIncrementDisplay,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.send(itemsNotInProgress.map(function(item){return"id[]="+item.promoId}).join("&"))}},iinfo.promo.PromoApiFooter.prototype.isDisplayInProgress=function(item){return item._isDisplayInProgress&&!0===item._isDisplayInProgress},iinfo.promo.PromoApiFooter.prototype.setDisplayInProgress=function(item,isInProgress){item._isDisplayInProgress=isInProgress},iinfo.promo.PromoApiFooter.prototype.setAllDisplayInProgress=function(items,isInProgress){var that=this;items.forEach(function(item){that.setDisplayInProgress(item,isInProgress)})},iinfo.promo.PromoCarousel=function(selectorWrapper,selectorOwlCarouselElement,visibleItemsCount,linksEnabled,promoApi){this.selectorWrapper=selectorWrapper,this.selectorOwlCarouselElement=selectorOwlCarouselElement,this.visibleItemsCount=visibleItemsCount,this.linksEnabled=linksEnabled,this.promoApi=promoApi,this.$wrapper=null,this.$owlCarouselElement=null,this.scrollCheckingEnable=!1,this.items=[]},iinfo.promo.PromoCarousel.wrapperResponsiveXxsClass="promo--responsive-xxs",iinfo.promo.PromoCarousel.prototype.pushPromoItem=function(promoItem){this.items.push(promoItem)},iinfo.promo.PromoCarousel.prototype.getPromoItem=function(index){return this.items[index]},iinfo.promo.PromoCarousel.prototype.initialize=function(){var that=this;this.$wrapper=$(this.selectorWrapper),this.$owlCarouselElement=$(this.selectorOwlCarouselElement),$(".owl-lazy").removeClass("hide"),this.linksEnabled&&$("a[data-url]",this.$owlCarouselElement).mousedown(function(){var $this=$(this);$this.attr("href",$this.attr("data-url"))}),this.$owlCarouselElement.on("initialize.owl.carousel",function(carouselEvent){if(that.visibleItemsCount!==carouselEvent.page.size){for(var promoElements=that.$owlCarouselElement.children(),promos=[],i=0;i<promoElements.length;i++)promos.push({el:promoElements[i],obj:that.getPromoItem(i)});promos.sort(function(promoA,promoB){return promoB.obj.getPhaseWeight()-promoA.obj.getPhaseWeight()});var visibleItems=promos.slice(0,carouselEvent.page.size),nonVisibleItems=promos.slice(carouselEvent.page.size);visibleItems.sort(function(){return.5-Math.random()}),nonVisibleItems.sort(function(){return.5-Math.random()}),promoElements.detach(),that.items=[],visibleItems.concat(nonVisibleItems).forEach(function(promo){that.$owlCarouselElement.append(promo.el),that.pushPromoItem(promo.obj)}),that.visibleItemsCount=carouselEvent.page.size}}),this.$owlCarouselElement.on("resized.owl.carousel",function(carouselEvent){that.visibleItemsCount=carouselEvent.page.size,that.isVisible()?that.incrementDisplayCountOfVisibleItems():that.startScrollChecking()}),this.$owlCarouselElement.owlCarousel({callbacks:!0,loop:!0,items:this.visibleItemsCount,dots:!1,nav:!0,navRewind:!1,lazyLoad:!0,navText:["<i class='zurueck'><</i>","<i class='vorn'>></i>"],responsiveBaseElement:".promo",onLoadedLazy:function(){that.setFullWidth(!1)},onResized:function(){that.setFullWidth(!1)},onChanged:function(){that.setFullWidth(!1)},responsive:{0:{items:1,onLoadedLazy:function(){that.setFullWidth(!0)},onResized:function(){that.setFullWidth(!0)},onChanged:function(){that.setFullWidth(!0)}},368:{items:2},552:{items:3},736:{items:4},920:{items:5},1104:{items:6},1288:{items:7}}}),this.$owlCarouselElement.on("translated.owl.carousel",function(){that.isVisible()&&that.incrementDisplayCountOfVisibleItems()}),$(".owl-prev",this.$owlCarouselElement).bind("click",function(){that.$owlCarouselElement.trigger("prev.owl.carousel")}),$(".owl-next",this.$owlCarouselElement).bind("click",function(){that.$owlCarouselElement.trigger("next.owl.carousel")}),that.isVisible()?that.incrementDisplayCountOfVisibleItems():that.startScrollChecking()},iinfo.promo.PromoCarousel.prototype.setFullWidth=function(isTurnedOn){isTurnedOn?this.$wrapper.addClass(iinfo.promo.PromoCarousel.wrapperResponsiveXxsClass):this.$wrapper.removeClass(iinfo.promo.PromoCarousel.wrapperResponsiveXxsClass)},iinfo.promo.PromoCarousel.prototype.isVisible=function(){return this.$owlCarouselElement.offset().top-$(window).height()+10<$(window).scrollTop()},iinfo.promo.PromoCarousel.prototype.startScrollChecking=function(){if(!this.scrollCheckingEnable){this.scrollCheckingEnable=!0;var that=this;$(window).on("scroll",function(scrollEvent){that.isVisible()&&(that.incrementDisplayCountOfVisibleItems(),$(this).off(scrollEvent),that.scrollCheckingEnable=!1)})}},iinfo.promo.PromoCarousel.prototype.getVisibleIndexes=function(){for(var event=this.$owlCarouselElement.data("owlCarousel").trigger(""),visibleIndexes=[],index=event.item.index-event.page.size,i=0;i<event.page.size;i++)index===event.item.count&&(index=0),visibleIndexes.push(index++);return visibleIndexes},iinfo.promo.PromoCarousel.prototype.incrementDisplayCountOfVisibleItems=function(){if(this.isVisible()){var itemsForDisplaying=[],that=this;this.getVisibleIndexes().forEach(function(index){var item=that.getPromoItem(index);item instanceof iinfo.promo.PromoItem&&!item.getDisplayed()&&itemsForDisplaying.push(item)}),this.promoApi.display(itemsForDisplaying)}}}($jquery1_11);