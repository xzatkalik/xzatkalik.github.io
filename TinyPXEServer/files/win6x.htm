<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><link type="text/css" rel="stylesheet" href="style1.css" media="screen" /><title>Tiny PXE Server</title></head><body><font> 
 
 
 
<p> 
<select ONCHANGE="location = this.options[this.selectedIndex].value;"> 
<option value="" disabled></option> 
<option value="../index.html">Contents</option> 
<option value="" disabled>=======</option> 
<option value="pxesrv_about.htm">Introduction</option> 
<option value="pxesrv_settings.htm">Settings</option> 
<option value="pxesrv_gui.htm">GUI Settings</option> 
<option value="pxesrv_config.htm">Config.ini settings</option> 
<option value="pxesrv_service.htm">Run as Service</option> 
<option value="firewall.htm">Firewall Settings</option> 
<option value="test_system.htm">Test System(s)</option> 
<option value="misc.htm">Miscellaneous</option> 
<option value="troubleshooting.htm">Troubleshooting</option> 
<option value="" disabled></option> 
<option value="" disabled>Boot Loaders</option> 
<option value="" disabled>==========</option> 
<option value="pxelinux.htm">PXELINUX</option> 
<option value="grub4dos.htm">Grub4Dos</option> 
<option value="ipxe.htm">iPXE</option> 
<option value="" disabled></option> 
<option value="" disabled>Boot</option> 
<option value="" disabled>====</option> 
<option value="fdd.htm">Floppy Disk Image</option> 
<option value="iso.htm">ISO Image</option> 
<option value="" disabled></option> 
<option value="" disabled>Linux</option> 
<option value="" disabled>=====</option> 
<option value="centos_netinstall.htm">CentOS - Network...</option> 
<option value="debian_netinstall.htm">Debian - Network...</option> 
<option value="fatdog.htm">FatDog</option> 
<option value="gparted.htm">GPartEd</option> 
<option value="ubuntu.htm">ubuntu/Lubuntu</option> 
<option value="ubuntu_netinstall.htm">ubuntu - Network...</option> 
<option value="" disabled></option> 
<option value="" disabled>WinPE</option> 
<option value="" disabled>=====</option> 
<option value="winpe.htm">WinPE</option> 
<option value="winpe_wimboot.htm">WinPE (wimboot)</option> 
<option value="winpe_bcd.htm">Multiple WinPE</option> 
<option value="" disabled></option> 
<option value="" disabled>Net Install Windows</option> 
<option value="" disabled>===============</option> 
<option value="ris.htm">RIS</option> 
<option value="ris_issues.htm">Troubleshooting RIS</option> 
<option value="win6x.htm" selected="selected">Install Windows NT 6.*</option> 
<option value="win5x.htm">Install Windows NT 5.*</option> 
<option value="" disabled></option> 
<option value="" disabled>SANBOOT (AoE)</option> 
<option value="" disabled>================</option> 
<option value="aoe_target.htm">AoE (Windows T...</option> 
<option value="aoe_install_winnt5.htm">AoE (Install Driver...</option> 
<option value="aoe_install_winnt6.htm">AoE (Install Driver...</option> 
<option value="aoe.htm">AoE (Clone...</option> 
<option value="" disabled></option> 
<option value="" disabled>SANBOOT (iSCSI)</option> 
<option value="" disabled>================</option> 
<option value="iscsi_targets.htm">iSCSI (Windows T...</option> 
<option value="iscsi_kernsafe.htm">iSCSI (Kernsafe...</option> 
<option value="iscsi_ms.htm">iSCSI (Microsoft...</option> 
<option value="iscsi_pytarget.htm">iSCSI (pyTarget)</option> 
<option value="iscsi.htm">iSCSI (Clone...</option> 
<option value="iscsi_install.htm">iSCSI (Install...</option> 
<option value="iscsi_centos.htm">iSCSI ...CentOS</option> 
<option value="iscsi_ubuntu.htm">iSCSI ...ubuntu</option> 
<option value="iscsi_ubuntu_netinstall.htm">iSCSI ...ubuntu (2)</option> 
<option value="" disabled></option> 
<option value="" disabled>Miscellaneous</option> 
<option value="" disabled>===========</option> 
<option value="clone.htm">Capture Windows...</option> 
<option value="clone_strarc.htm">Copy Windows...</option> 
<option value="service.htm">Network Adapter C...</option> 
<option value="wfplwf.htm">Unbinding The Light...</option> 
<option value="forensics.htm">Digital Forensic Acq...</option> 
<option value="ipxe_build.htm">iPXE - How to...</option> 
<option value="" disabled></option> 
<option value="" disabled>Appendices</option> 
<option value="" disabled>=========</option> 
<option value="pxesrv_zip.htm">Contents of pxesrv.zip</option> 
<option value="pxesrv_faq.htm">Erwan's FAQ</option> 
<option value="ack.htm">Acknowledgements...</option> 
<option value="" disabled></option> 
</select> 
</p> 
 
 
 
<hr> 
<img src="img/logo6.jpg" BORDER=1></a> 
 



<h2 align="center"><u>Installing Windows NT 6.*</u></h2>



<p>
My preferred method for installing Windows NT 6.* (Windows 7/8/8.1 etc) is booting into a custom WinPE (<a target="_blank" href="http://reboot.pro/files/file/357-mistype/">MistyPE</a>) and running <font class="file">setup.exe</font> - either from a mounted <font class="file">.iso</font> or a network share. The main limitation in using this method is the requirement for using a 32-bit WinPE to run the 32-bit Windows installer or a 64-bit WinPE to run the 64-bit Windows installer. There are other methods that can be used to overcome this limitation.
</p>


<p>
<ul>
<li><a class="glossary" href="win6x.htm#server">Configuring the Server</a></li>
<li><a class="glossary" href="win6x.htm#share">Connect to the network share</a></li>
<li><a class="glossary" href="win6x.htm#setup.exe">Run setup.exe</a></li>
<li><a class="glossary" href="win6x.htm#wimlib">Alternative Method</a></li>
</ul>
</p>


<p>
<img src="img/7setup2.jpg" border="2">
</p>


<a name="server"></a>
<h3 class="breaktop"><u>Configuring the Server</u></h3>

<p>
Setup <font class="file">Tiny PXE Server</font> to include <font class="file">MistyPE</font> (or an alternative WinPE build - including <font class="file">boot.wim</font> from Windows installation media, <font class="file">WinRE</font>, etc) using the instructions in the <a class="glossary" href="winpe.htm">WinPE<a> section of this guide (copying <font class="file">boot.wim</font>, <font class="file">boot.sdi</font>, <font class="file">boot\BCD</font>, etc - <font class="file">filename=pxeboot.n12</font> in <font class="file">config.ini</font>).
</p>



<p>
Using Windows 7 as an example, copy the contents of your Windows 7 installation DVD to <font class="file">C:\pxesrv\files\win7</font> (edit paths to reflect your own setup). Now share the <font class="file">C:\pxesrv\files\win7</font> directory as sharename <font class="file">win7</font>. 
</p>



<p>
Start <font class="file">pxesrv.exe</font>. 
</p>

















<a name="share"></a>
<h3 class="breaktop"><u>Connect to the network share</u></h3>


<p>
Network boot the Client PC - loading <font class="file">WinPE</font>.
</p>


<p>
Start network services if they are not started automatically (<font class="file">MistyPE</font> does not run the <font class="file">Wpeutil InitializeNetwork</font> command at startup).
</p>





<p>
<u>Server setup</u> (information required for connecting to the server share <font class="file">win7</font>) - 
<ul>
<li><b>IP Address</b> - 192.168.2.1</li>
<li><b>Computer Name</b> - SERVER</li>
<li><b>Account</b> - Admin</li>
<li><b>Admin Account password</b> - mypassword</li>
</ul>
</p>



<p>
To connect to a network share from WinPE the following command syntax is used - 
<br />
<textarea style="font-size:12px" cols="80" rows="3" align=left readonly>

net use DRIVE: \\REMOTE_COMPUTER\SHARE /u:ACCOUNT "PASSWORD" 
</textarea>

<p>
Where -
<ul>
<li><b>DRIVE:</b> - mount point to be used (e.g. Z:). Alternatively use * to allocate an available drive letter.</li>
</ul>

<ul>
<li><b>REMOTE_COMPUTER</b> - IP (v4) address of the computer containing the share (e.g. 192.168.2.1) - or alternatively use the Computer (NetBIOS) Name.</li>
</ul>

<ul>
<li><b>SHARE</b> - name of network share on the REMOTE_COMPUTER (e.g. win7).</li>
</ul>

<ul>
<li><b>ACCOUNT</b> - a valid account/username for the REMOTE_COMPUTER (e.g. Admin)</li>
</ul>

<ul>
<li><b>PASSWORD</b> - password for connecting to the account name used above. If password has not been set then use empty quotes "".</li>
</ul>
</p>

<p>
E.g. 
<ul>
<li><font class="file">net use Z: \\192.168.2.1\win7 /u:Admin "mypassword"</font></li>
<li><font class="file">net use * \\SERVER\win7 /u:Admin "mypassword"</font></li>
</ul>
</p>












<a name="setup.exe"></a>
<h3 class="breaktop"><u>Run setup.exe</u></h3>


<p>
Assuming there were no issues connecting to the network share in the preceding step, and the share was mounted as <b>Z:</b>, run the following command from a command prompt -
<ul>
<li><font class="file">Z:\setup.exe</font></li>
</ul>
</p>



<p>
<img src="img/7setup1.jpg" border="2">
</p>








<a name="wimlib"></a>
<h3 class="breaktop"><u>Alternative Method</u></h3>



<p>
There are a range of alternatives to running <font class="file">setup.exe</font> - my preferred method is using <a target="_blank" href="http://reboot.pro/topic/18345-wimlib-with-imagex-implementation/">Wimlib-ImageX</a> (download <a target="_blank" href="http://sourceforge.net/projects/wimlib/">here</a>) - a Linux version is also available. Add <font class="file">Wimlib-Imagex.exe</font> (and dependencies) to your WinPE build - or add them to the <font class="file">win7</font> share if this is more convenient.
</p>



<p>
Follow the instructions in the <a class="glossary" href="win6x.htm#share">Connect to the network share</a> section. We'll assume here that the share is mounted as <b>Z:</b>.
</p>



<p>
You will need to prepare the hard disk on the client system before running <font class="file">Wimlib-Imagex.exe</font> - create an active primary partition for the Windows installation if required. <font class="file">diskpart.exe</font> in WinPE can be used to prepare the disk - it will automatically add the code required to load <font class="file">BOOTMGR</font> (the windows boot loader) to the volume boot record when formatting the volume. We'll assume in the instructions below that the volume to be used for the Windows Operating System is mounted as <b>C:</b>
</p>



<p>
Apply the contents of <font class="file">Z:\sources\install.wim</font> to your local volume using the syntax below -
<br />
<textarea style="font-size:12px" cols="80" rows="3" align=left readonly>

wimlib-imagex.exe apply [WIM] [IMAGE_NUMBER] [TARGET]
</textarea>
</p>



<p>
Where -
<ul>
<li><b>apply</b> - wimlib command used to extract the contents of a <font class="file">.wim</font> file to another location.</li>
</ul>

<ul>
<li><b>WIM</b> - <font class="file">.wim</font> file (e.g. <font class="file">Z:\sources\install.wim</font>).</li>
</ul>

<ul>
<li><b>IMAGE_NUMBER</b> - <font class="file">.wim</font> files can contain multiple images - use this to specify which image to <font class="file">apply</font> to the <font class="file">target</font> (e.g. 5).</li>
</ul>

<ul>
<li><b>TARGET</b> - the volume to apply the contents of your <font class="file">.wim</font> file to (e.g. <font class="file">C:\</font>).</li>
</ul>
</p>


<p>
E.g. 
<ul>
<li><font class="file">wimlib-imagex.exe apply Z:\sources\install.wim 5 C:\</font></li>
</ul>
</p>





<p>
After applying the Windows OS to volume <b>C:</b> you will need to create boot files. Use <font class="file">bcdboot.exe</font> with the following command (edit to reflect your own setup) -
<ul>
<li><font class="file">bcdboot.exe C:\windows /s C:\</font></li>
</ul>
</p>



<p>
Sample batch file for applying <font class="file">Z:\sources\install.wim</font> and running <font class="file">bcdboot</font> (edit to reflect your own setup) -
<br />
<textarea style="font-size:12px" cols="80" rows="30" align=left readonly>

@echo off

SETLOCAL
SET IMAGE_NUMBER=5
SET WIMLIB="%~dp0wimlib-imagex.exe"
SET WIM=Z:\sources\install.wim

::Drive needs to use syntax #:
SET TARGET=C:

:_menu
cls
echo.
ECHO Drive (%TARGET%) selected 
ECHO WIM - %WIM%
echo.
echo This script will atempt to -
echo   * Apply WIM (image %IMAGE_NUMBER%) to %TARGET%
echo   * run "bcdboot %TARGET%\windows /s %TARGET%" command
ECHO.
set choice=
set /p choice=Y or N to continue.
if '%choice%'=='y' goto _continue
if '%choice%'=='Y' goto _continue
if '%choice%'=='n' goto _end
if '%choice%'=='N' goto _end
goto _menu

:_continue
cls
echo Apply %WIM% (image %IMAGE_NUMBER%) to %TARGET%
ECHO.
%WIMLIB% apply %WIM% %IMAGE_NUMBER% %TARGET%\
echo.
echo.
echo.
pause

cls
echo running "bcdboot %TARGET%\windows /s %TARGET%" command
echo.
bcdboot %TARGET%\windows /s %TARGET%

:_end
cls
echo.
echo.
echo.
pause
ENDLOCAL
exit

</textarea>
</p>

























<p class="breakbottom">
</p>




<p class="breaktop"><font class="file">Document date - 28<sup>th</sup> February 2017(DRAFT)</font></p></font></body></html>